---
title: "foraging"
author: "Daniel Suh"
date: "`r Sys.Date()`"
output: html_document
---

```{r, message = F}
library(here)
source(here("base","src.R"))
```

```{r}
data <- read_csv(here("raw_data","foraging.csv"))
```
Effects of temperature and resources on prevalence
![prevalence](figures/prob_inf.png)


```{r}
data %<>% mutate(length = as.numeric(length),
                 start_min = time_in_hr*60+time_in_min,
                 end_min = time_measured_hr*60+time_measured_min,
                 time = end_min-start_min,
                 vol = 15)

control <- data %>% filter(trt=="C") %>% group_by(temp, resource, block) %>% summarize(control_read = mean(read, na.rm=T))

data %<>% left_join(., control)
```

```{r}
data %<>% filter(trt=="trt") %>% mutate(rate = log(control_read/read)*(vol/time),
                                                    amt_time = (control_read - read)/time)

data_summ <- data %>% group_by(temp, resource) %>% summarize(rate_mean = mean(rate),
                                                             rate_var = var(rate),
                                                             rate_sd = sd(rate),
                                                             rate_se = sd(rate)/sqrt(n()),
                                                             amt_mean = mean(amt_time),
                                                             amt_var = var(amt_time),
                                                             amt_sd = sd(amt_time),
                                                             amt_se = sd(amt_time)/sqrt(n()),
                                                             length_mean = mean(length, na.rm = T),
                                                             length_var = var(length, na.rm = T),
                                                             length_sd = sd(length, na.rm = T),
                                                             length_se = sd(length, na.rm = T)/sqrt(n()))

# data_summ <- data %>% group_by(temp, resource, block) %>% summarize(mean_rate = mean(rate),
#                                                              var = var(rate),
#                                                              sd = sd(rate),
#                                                              se = sd(rate)/sqrt(n()))
# 
# data_summ1 %<>% mutate(block = NA)
# 
# data_summ %<>% rbind(., data_summ1)

# data_summ %<>% mutate(ID = paste(temp,resource, sep = "_"),
#                       block_ID = paste(temp, resource, block, sep = "_"))

data_summ %<>% mutate(ID = paste(temp,resource, sep = "_"))


saveRDS(data_summ, file = here("processed_data", "foraging.rds"))

```


```{r}
data_summ %>% 
#  filter(is.na(block)) %>% 
  ggplot(aes(x=ID, y=rate_mean)) + 
  geom_point() + 
  geom_linerange(aes(ymin=rate_mean-rate_se, ymax=rate_mean+rate_se)) + 
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust = 1)) + 
  labs(y = "mL/minute",
       x = "treatment")
```

```{r}
data_summ %>% 
#  filter(is.na(block)) %>% 
  ggplot(aes(x=as.factor(resource), y=rate_mean, group = temp, color = as.factor(temp))) + 
  geom_point(position = position_dodge(width = 0.5)) + 
  geom_linerange(aes(ymin=rate_mean-rate_se, ymax=rate_mean+rate_se),position = position_dodge(width = 0.5)) + 
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust = 1)) + 
  scale_color_manual(values = c("#619CFF", "#00BA38", "#F8766D")) +
  labs(y = "mL/minute",
       x = "Resource",
       color = "Temp")
```

![prevalence](figures/prob_inf.png)


```{r}
data_summ %>% ggplot(aes(x=ID, y=amt_mean)) + 
  geom_point() + 
  geom_linerange(aes(ymin=amt_mean-amt_se, ymax=amt_mean+amt_se)) + 
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust = 1)) + 
  labs(y = "mL/minute",
       x = "treatment")
```

```{r}
data_summ %>% ggplot(aes(x=as.factor(resource), y=amt_mean, group = temp, color = as.factor(temp))) + 
  geom_point(position = position_dodge(width = 0.5)) + 
  geom_linerange(aes(ymin=amt_mean-amt_se, ymax=amt_mean+amt_se),position = position_dodge(width = 0.5)) + 
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust = 1)) + 
  scale_color_manual(values = c("#619CFF", "#00BA38", "#F8766D")) +
  labs(y = "fluor diff/time (min)",
       x = "Resource",
       color = "Temp")
```

```{r}
data_summ %>% ggplot(.,aes(x=length_mean, y=rate_mean, color = as.factor(temp), shape = as.factor(resource))) + 
  geom_point(aes(),size = 3) +
  geom_errorbarh(aes(xmin = length_mean-length_se, xmax = length_mean+length_se)) +
  geom_errorbar(aes(ymin = rate_mean-rate_se, ymax = rate_mean+rate_se)) +
  scale_color_manual(values = c("#619CFF", "#00BA38", "#F8766D")) +
  labs(x = "Average Length (raw)", y = "feeding rate (mL/min)", color = "Temp", shape = "Resource")

```

