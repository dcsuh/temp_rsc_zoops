---
title: "foraging"
author: "Daniel Suh"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
library(here)
source(here("base","src.R"))
```

```{r}
data <- read_csv(here("raw_data","foraging.csv"))
```


```{r}
data %<>% mutate(start_min = time_in_hr*60+time_in_min,
                 end_min = time_measured_hr*60+time_measured_min,
                 time = end_min-start_min,
                 vol = 15)

control <- data %>% filter(trt=="C") %>% group_by(temp, resource, block) %>% summarize(control_read = mean(read))

data %<>% left_join(., control)
```

```{r}
data_summ <- data %>% filter(trt=="trt") %>% mutate(rate = log(control_read/read)*(vol/time))

data_summ %<>% group_by(temp, resource, block) %>% summarize(mean_rate = mean(rate),
                                                             var = var(rate),
                                                             sd = sd(rate),
                                                             se = sd(rate)/sqrt(n()))

data_summ %<>% mutate(ID = paste(temp,resource, sep = "_"),
                      block_ID = paste(temp, resource, sep = "_"))
```

```{r}
data_summ %>% ggplot(aes(x=ID, y=mean_rate)) + 
  geom_point() + 
  geom_linerange(aes(ymin=mean_rate-se, ymax=mean_rate+se)) + 
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust = 1)) + 
  labs(y = "mL/minute",
       x = "treatment")
```

```{r}
data_summ %>% ggplot(aes(x=as.factor(resource), y=mean_rate, group = temp, color = as.factor(temp))) + 
  geom_point(position = position_dodge(width = 0.5)) + 
  geom_linerange(aes(ymin=mean_rate-se, ymax=mean_rate+se),position = position_dodge(width = 0.5)) + 
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust = 1)) + 
  scale_fill_manual(values = c("#619CFF", "#00BA38", "#F8766D")) + 
  labs(y = "mL/minute",
       x = "treatment")
```

![prevalence](figures/prob_inf.png)

